import{I as N,J as v,K as y,N as S,o as w,r as g,u as Q,p as E,j as t,L as C,f as F,c as M,E as k,H as q,O as L,q as R,w as P,W as _,P as A}from"./index-61294d4c.js";import{R as D,a as H}from"./RequireAuth-0c93938b.js";import{b as B,o as I,t as x,S as T}from"./SkeletonCard-3cfb02b0.js";import{u as U}from"./useMutation-be516369.js";import{P as $}from"./Pagination-2f1f3744.js";import{Q as z,a as W,b as K,c as J,e as V,d as Y,f as G,s as O,g as j,w as X,h as Z,u as ee}from"./useQuery-8e56d916.js";class se extends N{constructor(n,c){super(),this.client=n,this.queries=[],this.result=[],this.observers=[],this.observersMap={},c&&this.setQueries(c)}onSubscribe(){this.listeners.length===1&&this.observers.forEach(n=>{n.subscribe(c=>{this.onUpdate(n,c)})})}onUnsubscribe(){this.listeners.length||this.destroy()}destroy(){this.listeners=[],this.observers.forEach(n=>{n.destroy()})}setQueries(n,c){this.queries=n,v.batch(()=>{const o=this.observers,l=this.findMatchingObservers(this.queries);l.forEach(a=>a.observer.setOptions(a.defaultedQueryOptions,c));const u=l.map(a=>a.observer),p=Object.fromEntries(u.map(a=>[a.options.queryHash,a])),r=u.map(a=>a.getCurrentResult()),h=u.some((a,m)=>a!==o[m]);o.length===u.length&&!h||(this.observers=u,this.observersMap=p,this.result=r,this.hasListeners()&&(y(o,u).forEach(a=>{a.destroy()}),y(u,o).forEach(a=>{a.subscribe(m=>{this.onUpdate(a,m)})}),this.notify()))})}getCurrentResult(){return this.result}getQueries(){return this.observers.map(n=>n.getCurrentQuery())}getObservers(){return this.observers}getOptimisticResult(n){return this.findMatchingObservers(n).map(c=>c.observer.getOptimisticResult(c.defaultedQueryOptions))}findMatchingObservers(n){const c=this.observers,o=n.map(e=>this.client.defaultQueryOptions(e)),l=o.flatMap(e=>{const s=c.find(d=>d.options.queryHash===e.queryHash);return s!=null?[{defaultedQueryOptions:e,observer:s}]:[]}),u=l.map(e=>e.defaultedQueryOptions.queryHash),p=o.filter(e=>!u.includes(e.queryHash)),r=c.filter(e=>!l.some(s=>s.observer===e)),h=e=>{const s=this.client.defaultQueryOptions(e),d=this.observersMap[s.queryHash];return d??new z(this.client,s)},a=p.map((e,s)=>{if(e.keepPreviousData){const d=r[s];if(d!==void 0)return{defaultedQueryOptions:e,observer:d}}return{defaultedQueryOptions:e,observer:h(e)}}),m=(e,s)=>o.indexOf(e.defaultedQueryOptions)-o.indexOf(s.defaultedQueryOptions);return l.concat(a).sort(m)}onUpdate(n,c){const o=this.observers.indexOf(n);o!==-1&&(this.result=S(this.result,o,c),this.notify())}notify(){v.batch(()=>{this.listeners.forEach(n=>{n(this.result)})})}}function te({queries:i,context:n}){const c=w({context:n}),o=W(),l=g.useMemo(()=>i.map(e=>{const s=c.defaultQueryOptions(e);return s._optimisticResults=o?"isRestoring":"optimistic",s}),[i,c,o]),[u]=g.useState(()=>new se(c,l)),p=u.getOptimisticResult(l);K(g.useCallback(e=>o?()=>{}:u.subscribe(v.batchCalls(e)),[u,o]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),g.useEffect(()=>{u.setQueries(l,{listeners:!1})},[l,u]);const r=J();l.forEach(e=>{V(e,r),Y(e)}),G(r);const a=p.some((e,s)=>O(l[s],e,o))?p.flatMap((e,s)=>{const d=l[s],f=u.getObservers()[s];if(d&&f){if(O(d,e,o))return j(d,f,r);X(e,o)&&j(d,f,r)}return[]}):[];if(a.length>0)throw Promise.all(a);const m=p.find((e,s)=>{var d,f;return Z({result:e,errorResetBoundary:r,useErrorBoundary:(d=(f=l[s])==null?void 0:f.useErrorBoundary)!=null?d:!1,query:u.getQueries()[s]})});if(m!=null&&m.error)throw m.error;return p}const re=({data:i,mediaType:n,size:c})=>{var e;if(!i)return null;const[o,l]=Q(),u=w(),p=E(),r=g.useMemo(()=>parseInt(o.get("page")||"1"),[o]),h=g.useMemo(()=>{let s,d,f;if(n==="movie"){let b=i;s=b.title,f=b.release_date,d="movie"}else{let b=i;s=b.name,f=b.first_air_date,d="tv"}return{name:s,media_type:d,date:f}},[i]),a=U({mutationFn:s=>(p==null||p.showLoader(),R.removeFavorite(s)),onSuccess(s,d,f){return console.log(s),u.invalidateQueries({queryKey:["favorites",{page:r}],exact:!0}),s},onError(s,d,f){return s},onSettled(s,d,f,b){return p==null||p.hiddenLoader(),s}}),m=()=>{a.mutate({type:n,id:i.id+""}),console.log("click")};return t.jsxs("div",{children:[t.jsx("div",{className:"card hover:scale-105 transition-transform duration-300 overflow-hidden rounded-xl",children:t.jsx(C,{to:`${F[h.media_type]}/${encodeURIComponent((e=h.name)==null?void 0:e.toLowerCase()).replace(/%20/g,"-")||""}/${i.id}`,className:"w-full block h-full",children:t.jsxs("div",{className:M("list__card-content group",{"h-60":c==="normal","h-[280px]":c==="large"}),children:[t.jsx(B.LazyLoadImage,{wrapperClassName:"w-full h-full block",effect:"blur",loading:"lazy",className:"w-full h-full block object-cover",src:I(i.poster_path),alt:i.poster_path}),t.jsxs("div",{className:"absolute bottom-0  py-3 left-0 w-full px-3  z-[6]",children:[t.jsx("div",{className:"text-white block font-light text-[14px] hover:text-dark-teal transition-colors duration-300",children:h.name}),t.jsxs("div",{className:"flex items-end  text-light-gray text-xs",children:[t.jsx("span",{children:h.date?new Date(h.date).getFullYear():"N/A"}),t.jsxs("span",{className:"flex items-center ml-2 text-[10px] gap-[2px]",children:[t.jsx(k,{className:"text-sm"}),i.vote_average.toFixed(1)]}),t.jsx("span",{className:"inline-block text-[10px] border border-light-gray px-1 py-[2px] rounded ml-auto",children:h.media_type})]})]}),t.jsx("div",{className:`absolute top-2/4 left-2/4 -translate-x-2/4 -translate-y-2/4 bg-white rounded-full text-dark-teal \r
                        text-[36px] flex z-[6] scale-50 opacity-0 \r
                        group-hover:opacity-100 group-hover:scale-100 transition-all duration-300`,children:t.jsx(q,{})})]})})}),t.jsxs("button",{className:"text-red-400 text-xs flex items-center gap-0.5 pr-1 float-right mt-1.5",onClick:m,children:[t.jsx(L,{className:"scale-105"})," Unfavorite"]})]})},ae=({auth:i})=>{const[n,c]=Q(),o=g.useMemo(()=>parseInt(n.get("page")||"1"),[n]),{data:l,isLoading:u}=ee({queryKey:["favorites",{page:o}],queryFn:()=>R.getFavorites({page:o}),enabled:i==null?void 0:i.isLogged,keepPreviousData:!0}),p=te({queries:l?l.data.docs.map(r=>({queryKey:["favorite-detail",r.type,r.id],queryFn:async()=>r.type==="movie"?{...(await x.getDetail(r.type,+r.id)).data,mediaType:r.type}:{...(await x.getDetail(r.type,+r.id)).data,mediaType:r.type},enabled:(i==null?void 0:i.isLogged)&&l.data.docs.length>0,keepPreviousData:!0})):[]});return t.jsx("div",{className:"pt-20 pb-12 bg-black-2",children:t.jsx("section",{className:" py-6 bg-black-2",children:t.jsxs(_,{children:[t.jsx("h2",{className:'text-light-gray capitalize py-1 text-2xl relative after:content-[""] after:absolute after:bottom-0 after:left-0 after:w-16 after:h-[1px] after:bg-white/40',children:"Favorites"}),!(i!=null&&i.isLogged)&&t.jsx(D,{content:t.jsx(H,{icon:t.jsx(A,{}),title:"Enjoy your favorite",description:"Sign in to access your favorites that youâ€™ve saved"})}),(i==null?void 0:i.isLogged)&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid gap-y-4 gap-x-4 md:grid-cols-5 sm:grid-cols-4 xs:grid-cols-3 grid-cols-2 lg:grid-cols-6 mt-8",children:[u&&new Array(14).fill(0).map((r,h)=>t.jsx(T,{},h.toString()+"all")),p.length>0&&p.map(r=>{var h,a,m;return r.data?t.jsx(re,{data:r.data,mediaType:(h=r.data)==null?void 0:h.mediaType},`${(a=r.data)==null?void 0:a.mediaType}-${(m=r.data)==null?void 0:m.id}`):null}),l&&l.data.docs.length===0&&!u&&t.jsx("p",{className:"text-white font-medium col-span-full",children:"No items in the favorites list yet."})]}),l&&l.data.docs.length>0&&t.jsx($,{total:l.data.totalDoc,pageSize:20,defaultCurrent:1,className:"mt-6 w-fully"})]})]})})})},ie=P(ae),pe=()=>t.jsx(ie,{});export{pe as default};
